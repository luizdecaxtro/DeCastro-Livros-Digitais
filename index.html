<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja DeCastro - Produtos Digitais</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    .modal-overlay {
      backdrop-filter: blur(4px);
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    button {
      min-height: 40px;
      display: inline-flex !important;
      align-items: center;
      justify-content: center;
    }
    .qr-placeholder {
      background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <h1 class="text-3xl font-bold text-gray-800">üè™ Loja DeCastro - Produtos Digitais</h1>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex space-x-8">
        <button onclick="switchTab('loja')" id="tab-loja" class="py-4 px-2 border-b-2 border-blue-600 font-medium text-blue-600 transition-colors">
          üè™ Loja
        </button>
        <button onclick="switchTab('carrinho')" id="tab-carrinho" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          üõí Carrinho (<span id="cart-count">0</span>)
        </button>
        <button onclick="switchTab('admin')" id="tab-admin" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          ‚öôÔ∏è Administra√ß√£o (<span id="products-count">0</span>)
        </button>
        <button onclick="switchTab('vendas')" id="tab-vendas" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          üí∞ Vendas (<span id="sales-count">0</span>)
        </button>
        <button onclick="switchTab('termos')" id="tab-termos" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          üìú Termos de Uso
        </button>
        <button onclick="switchTab('privacidade')" id="tab-privacidade" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          üîí Privacidade
        </button>
        <button onclick="switchTab('contato')" id="tab-contato" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300 transition-colors">
          üìû Contato
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-4 py-8">

    <!-- Store Tab -->
    <div id="loja-content" class="fade-in">
      <div class="mb-6 flex justify-between items-center">
        <h2 class="text-2xl font-bold flex items-center gap-2">
          <i data-lucide="store" class="w-6 h-6"></i>
          Produtos Dispon√≠veis
        </h2>
        <button onclick="openProductForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors font-medium">
          ‚ûï Cadastrar Produto
        </button>
      </div>
      <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- Products will be rendered here -->
      </div>
    </div>

    <!-- Cart Tab -->
    <div id="carrinho-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="shopping-cart" class="w-6 h-6"></i>
          Seu Carrinho
        </h2>
        <div id="cart-items">
          <!-- Cart items will be rendered here -->
        </div>
        <div id="cart-summary" class="mt-6 pt-6 border-t">
          <!-- Cart summary will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Admin Tab -->
    <div id="admin-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="settings" class="w-6 h-6"></i>
          Administra√ß√£o de Produtos
        </h2>
        <div id="admin-products-list">
          <!-- Admin products will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Sales Tab -->
    <div id="vendas-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="dollar-sign" class="w-6 h-6"></i>
          Vendas Realizadas
        </h2>
        <div id="sales-list">
          <!-- Sales will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Terms Tab -->
    <div id="termos-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="file-text" class="w-6 h-6"></i>
          Termos de Uso
        </h2>
        <div class="prose max-w-none">
          <h3 class="text-lg font-semibold mb-3">üìã 1. Aceita√ß√£o dos Termos</h3>
          <p>Ao acessar e utilizar a <strong>Loja DeCastro</strong>, voc√™ concorda integralmente com estes Termos de Uso. Se n√£o concordar com algum item, n√£o utilize nossos servi√ßos.</p>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üì± 2. Sobre os Produtos Digitais</h3>
          <ul class="space-y-2">
            <li><strong>Entrega Imediata:</strong> Produtos digitais s√£o liberados automaticamente ap√≥s confirma√ß√£o do pagamento</li>
            <li><strong>Acesso Vitalicio:</strong> Uma vez adquirido, voc√™ ter√° acesso permanente ao produto</li>
            <li><strong>Formato Digital:</strong> Todos os produtos s√£o entregues em formato digital (PDF, v√≠deo, software, etc.)</li>
            <li><strong>Compatibilidade:</strong> Verificamos compatibilidade com principais dispositivos e sistemas</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üí∞ 3. Pagamentos e Reembolsos</h3>
          <ul class="space-y-2">
            <li><strong>M√©todos Aceitos:</strong> PIX (instant√¢neo) e Cart√£o de Cr√©dito</li>
            <li><strong>Seguran√ßa:</strong> Todos os pagamentos s√£o processados com criptografia SSL</li>
            <li><strong>Reembolso:</strong> At√© 7 dias corridos para produtos n√£o acessados/baixados</li>
            <li><strong>Problemas T√©cnicos:</strong> Garantia de 30 dias para quest√µes t√©cnicas</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üö´ 4. Uso Proibido</h3>
          <ul class="space-y-2">
            <li>√â <strong>proibido</strong> compartilhar, distribuir ou revender os produtos adquiridos</li>
            <li>N√£o √© permitido fazer engenharia reversa ou modificar os produtos</li>
            <li>O uso comercial depende de licen√ßa espec√≠fica (consulte-nos)</li>
            <li>Viola√ß√µes podem resultar em suspens√£o e a√ß√µes legais</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üîí 5. Responsabilidades</h3>
          <ul class="space-y-2">
            <li><strong>Nossa:</strong> Entregar produtos conforme descrito e manter seguran√ßa dos dados</li>
            <li><strong>Sua:</strong> Usar produtos legalmente e manter credenciais seguras</li>
            <li><strong>Suporte:</strong> Oferecemos suporte t√©cnico para instala√ß√£o e uso b√°sico</li>
            <li><strong>Atualiza√ß√µes:</strong> Produtos podem receber atualiza√ß√µes gratuitas</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">‚öôÔ∏è 6. Altera√ß√µes</h3>
          <p>Reservamo-nos o direito de alterar estes termos. Altera√ß√µes significativas ser√£o notificadas por email. Uso cont√≠nuo ap√≥s altera√ß√µes implica aceita√ß√£o.</p>
          
          <div class="bg-blue-50 p-4 rounded-lg mt-6">
            <p class="text-sm text-blue-700"><strong>üìû D√∫vidas?</strong> Entre em contato pelo WhatsApp (98) 98880-4678 ou email loja@decastro.com.br</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Privacy Tab -->
    <div id="privacidade-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="shield" class="w-6 h-6"></i>
          Pol√≠tica de Privacidade
        </h2>
        <div class="prose max-w-none">
          <h3 class="text-lg font-semibold mb-3">üîí 1. Compromisso com sua Privacidade</h3>
          <p>A <strong>Loja DeCastro</strong> respeita sua privacidade e est√° comprometida em proteger seus dados pessoais conforme a Lei Geral de Prote√ß√£o de Dados (LGPD).</p>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üìä 2. Dados que Coletamos</h3>
          <ul class="space-y-2">
            <li><strong>Dados de Cadastro:</strong> Nome, email, telefone para processamento de pedidos</li>
            <li><strong>Dados de Pagamento:</strong> Informa√ß√µes banc√°rias processadas por gateways seguros</li>
            <li><strong>Dados de Navega√ß√£o:</strong> IP, browser, p√°ginas visitadas para melhorar a experi√™ncia</li>
            <li><strong>Dados de Uso:</strong> Como voc√™ usa nossos produtos para oferecer suporte</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üéØ 3. Como Usamos seus Dados</h3>
          <ul class="space-y-2">
            <li><strong>Processamento:</strong> Para processar compras e entregar produtos</li>
            <li><strong>Comunica√ß√£o:</strong> Envio de confirma√ß√µes, suporte e atualiza√ß√µes</li>
            <li><strong>Melhorias:</strong> An√°lise para aprimorar produtos e servi√ßos</li>
            <li><strong>Legal:</strong> Cumprimento de obriga√ß√µes legais e fiscais</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üö´ 4. N√£o Compartilhamos</h3>
          <ul class="space-y-2">
            <li>Seus dados <strong>NUNCA</strong> s√£o vendidos para terceiros</li>
            <li>N√£o enviamos spam ou emails n√£o solicitados</li>
            <li>Compartilhamento apenas com processadores de pagamento (obrigat√≥rio)</li>
            <li>Dados anonimizados podem ser usados para estat√≠sticas</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üîê 5. Seguran√ßa</h3>
          <ul class="space-y-2">
            <li><strong>Criptografia SSL:</strong> Todos os dados em tr√¢nsito s√£o criptografados</li>
            <li><strong>Servidores Seguros:</strong> Armazenamento em datacenters certificados</li>
            <li><strong>Acesso Restrito:</strong> Apenas funcion√°rios autorizados acessam dados</li>
            <li><strong>Backups:</strong> C√≥pias de seguran√ßa regulares para preven√ß√£o de perda</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üéØ 6. Seus Direitos</h3>
          <ul class="space-y-2">
            <li><strong>Acesso:</strong> Solicitar c√≥pia dos seus dados</li>
            <li><strong>Corre√ß√£o:</strong> Corrigir dados incorretos</li>
            <li><strong>Exclus√£o:</strong> Solicitar remo√ß√£o dos dados (direito ao esquecimento)</li>
            <li><strong>Portabilidade:</strong> Receber dados em formato leg√≠vel</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üí¨ 7. Cookies</h3>
          <p>Utilizamos cookies para melhorar sua experi√™ncia de navega√ß√£o, lembrar prefer√™ncias e analisar o tr√°fego. Voc√™ pode desabilitar cookies no seu navegador.</p>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">üìû 8. Contato</h3>
          <p>Para exercer seus direitos ou tirar d√∫vidas sobre privacidade, entre em contato:</p>
          <ul class="space-y-1">
            <li><strong>Email:</strong> privacidade@decastro.com.br</li>
            <li><strong>WhatsApp:</strong> (98) 98880-4678</li>
            <li><strong>Resposta:</strong> At√© 15 dias √∫teis</li>
          </ul>
          
          <div class="bg-green-50 p-4 rounded-lg mt-6">
            <p class="text-sm text-green-700"><strong>üîí Garantia:</strong> Seus dados est√£o seguros conosco. Esta pol√≠tica √© atualizada regularmente para sua prote√ß√£o.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Tab -->
    <div id="contato-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="phone" class="w-6 h-6"></i>
          Entre em Contato
        </h2>
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="text-lg font-semibold mb-4">Informa√ß√µes de Contato</h3>
            <div class="space-y-3">
              <p class="flex items-center gap-2">
                <i data-lucide="phone" class="w-4 h-4"></i>
                <span>+55 (98) 98880-4678</span>
              </p>
              <p class="flex items-center gap-2">
                <i data-lucide="mail" class="w-4 h-4"></i>
                <span>contato@lojacastro.com</span>
              </p>
              <p class="flex items-center gap-2">
                <i data-lucide="map-pin" class="w-4 h-4"></i>
                <span>S√£o Lu√≠s - MA</span>
              </p>
            </div>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-4">Hor√°rio de Atendimento</h3>
            <div class="space-y-2">
              <p>Segunda a Sexta: 8h √†s 18h</p>
              <p>S√°bado: 8h √†s 12h</p>
              <p>Domingo: Fechado</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Product Form Modal -->
  <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md m-4 fade-in">
      <h3 class="text-xl font-bold mb-4">Cadastrar Produto</h3>
      <form id="product-form">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nome do Produto *</label>
            <input type="text" id="product-name" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Descri√ß√£o</label>
            <textarea id="product-description" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Pre√ßo (R$) *</label>
              <input type="number" id="product-price" step="0.01" min="0" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Categoria</label>
              <select id="product-category" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="Ebook">üìö Ebook</option>
                <option value="Curso">üéì Curso</option>
                <option value="Template">üìÑ Template</option>
                <option value="Software">üíª Software</option>
                <option value="Audio">üéµ Audio</option>
                <option value="Video">üé¨ Video</option>
                <option value="Outros">üì¶ Outros</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">URL da Imagem</label>
            <input type="url" id="product-image" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://example.com/image.jpg">
          </div>
        </div>
        <div class="flex gap-2 mt-6">
          <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600">
            Cancelar
          </button>
          <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
            Salvar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-2xl m-4 fade-in max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold mb-4">Finalizar Pagamento</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Nome Completo *</label>
        <input id="customer-name" type="text" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Digite seu nome completo" required>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Email *</label>
        <input id="customer-email" type="email" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="seu@email.com" required>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium mb-2">M√©todo de Pagamento:</label>
        <div class="space-y-3">
          <label class="flex items-center p-3 border-2 border-blue-200 bg-blue-50 rounded-lg cursor-pointer hover:bg-blue-100">
            <input type="radio" name="payment-method" value="pix" class="mr-3" checked>
            <span class="text-2xl mr-3">üöÄ</span>
            <div>
              <div class="font-bold text-blue-800">PIX - Pagamento Instant√¢neo</div>
              <div class="text-sm text-blue-600">‚úÖ Aprova√ß√£o imediata ‚Ä¢ ‚úÖ Sem taxas ‚Ä¢ ‚úÖ Dispon√≠vel 24h</div>
              <div class="text-xs text-green-600 font-bold">üéØ RECOMENDADO - Mais r√°pido e seguro!</div>
            </div>
          </label>

          <label class="flex items-center p-3 border-2 border-gray-200 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
            <input type="radio" name="payment-method" value="credit_card" class="mr-3">
            <span class="text-2xl mr-3">üí≥</span>
            <div>
              <div class="font-bold text-gray-800">Cart√£o de Cr√©dito</div>
              <div class="text-sm text-gray-600">üí≥ Parcelamento dispon√≠vel ‚Ä¢ üîí Pagamento seguro</div>
            </div>
          </label>
        </div>
      </div>

      <div class="flex gap-2">
        <button onclick="closePaymentModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
          Cancelar
        </button>
        <button onclick="processPayment()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
          üí∞ Pagar Agora
        </button>
      </div>
    </div>
  </div>

<script type="module">
  // Global variables
  let products = [];
  let cartItems = [];
  let sales = [];
  let currentTab = 'loja';

  // Initialize app
  document.addEventListener('DOMContentLoaded', function() {
    loadFromStorage();
    renderProductsGrid();
    updateCartDisplay();
    updateCartCount();
    updateProductsCount();
    updateSalesCount();
    lucide.createIcons();
    
    // Add some sample products if none exist
    if (products.length === 0) {
      addSampleProducts();
    }
  });

  // Tab switching
  function switchTab(tabName) {
    // Hide all content divs
    const contents = ['loja', 'carrinho', 'admin', 'vendas', 'termos', 'privacidade', 'contato'];
    contents.forEach(content => {
      document.getElementById(content + '-content').classList.add('hidden');
    });

    // Remove active state from all tabs
    contents.forEach(content => {
      const tab = document.getElementById('tab-' + content);
      tab.classList.remove('border-blue-600', 'text-blue-600');
      tab.classList.add('border-transparent', 'text-gray-700');
    });

    // Show selected content
    document.getElementById(tabName + '-content').classList.remove('hidden');

    // Activate selected tab
    const activeTab = document.getElementById('tab-' + tabName);
    activeTab.classList.add('border-blue-600', 'text-blue-600');
    activeTab.classList.remove('border-transparent', 'text-gray-700');

    currentTab = tabName;

    // Render content based on tab
    switch(tabName) {
      case 'carrinho':
        renderCartItems();
        break;
      case 'admin':
        renderAdminProducts();
        break;
      case 'vendas':
        renderSales();
        break;
    }

    // Recreate icons
    lucide.createIcons();
  }

  // Storage functions
  function saveToStorage() {
    localStorage.setItem('products', JSON.stringify(products));
    localStorage.setItem('cartItems', JSON.stringify(cartItems));
    localStorage.setItem('sales', JSON.stringify(sales));
  }

  function loadFromStorage() {
    products = JSON.parse(localStorage.getItem('products') || '[]');
    cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
    sales = JSON.parse(localStorage.getItem('sales') || '[]');
  }

  // Product management
  function addSampleProducts() {
    const sampleProducts = [
      {
        id: Date.now() + 1,
        name: "Ebook de Marketing Digital",
        description: "Guia completo para dominar o marketing digital",
        price: 29.90,
        category: "Ebook",
        image: "https://via.placeholder.com/300x200/3B82F6/FFFFFF?text=üìö+Ebook"
      },
      {
        id: Date.now() + 2,
        name: "Curso de Programa√ß√£o",
        description: "Aprenda programa√ß√£o do zero ao avan√ßado",
        price: 199.90,
        category: "Curso",
        image: "https://via.placeholder.com/300x200/10B981/FFFFFF?text=üéì+Curso"
      },
      {
        id: Date.now() + 3,
        name: "Template de Site",
        description: "Template profissional para seu site",
        price: 49.90,
        category: "Template",
        image: "https://via.placeholder.com/300x200/F59E0B/FFFFFF?text=üìÑ+Template"
      }
    ];

    products.push(...sampleProducts);
    saveToStorage();
    renderProductsGrid();
    updateProductsCount();
  }

  function openProductForm() {
    document.getElementById('product-modal').classList.remove('hidden');
  }

  function closeProductModal() {
    document.getElementById('product-modal').classList.add('hidden');
    document.getElementById('product-form').reset();
  }

  // Handle product form submission
  document.getElementById('product-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('product-name').value;
    const description = document.getElementById('product-description').value;
    const price = parseFloat(document.getElementById('product-price').value);
    const category = document.getElementById('product-category').value;
    const image = document.getElementById('product-image').value || `https://via.placeholder.com/300x200/6366F1/FFFFFF?text=${encodeURIComponent(category)}`;

    const product = {
      id: Date.now(),
      name,
      description,
      price,
      category,
      image
    };

    products.push(product);
    saveToStorage();
    renderProductsGrid();
    updateProductsCount();
    closeProductModal();
    
    alert('‚úÖ Produto cadastrado com sucesso!');
  });

  function renderProductsGrid() {
    const grid = document.getElementById('products-grid');
    
    if (products.length === 0) {
      grid.innerHTML = `
        <div class="col-span-full text-center py-12">
          <p class="text-gray-500 text-lg">Nenhum produto cadastrado</p>
          <button onclick="openProductForm()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
            Cadastrar Primeiro Produto
          </button>
        </div>
      `;
      return;
    }

    grid.innerHTML = products.map(product => `
      <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
        <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-t-lg" onerror="this.src='https://via.placeholder.com/300x200/6B7280/FFFFFF?text=üì¶+Produto'">
        <div class="p-4">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${product.category}</span>
          </div>
          <h3 class="font-bold text-lg mb-2 line-clamp-2">${product.name}</h3>
          <p class="text-gray-600 text-sm mb-3 line-clamp-2">${product.description}</p>
          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold text-green-600">R$ ${product.price.toFixed(2)}</span>
            <button onclick="addToCart(${product.id})" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
              <i data-lucide="shopping-cart" class="w-4 h-4"></i>
              Comprar
            </button>
          </div>
        </div>
      </div>
    `).join('');

    lucide.createIcons();
  }

  // Cart functions
  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    const existingItem = cartItems.find(item => item.productId === productId);
    
    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cartItems.push({
        productId: productId,
        quantity: 1
      });
    }

    saveToStorage();
    updateCartCount();
    
    // Show feedback
    alert(`‚úÖ ${product.name} adicionado ao carrinho!`);
  }

  function removeFromCart(productId) {
    const index = cartItems.findIndex(item => item.productId === productId);
    if (index > -1) {
      cartItems.splice(index, 1);
      saveToStorage();
      updateCartCount();
      renderCartItems();
    }
  }

  function updateQuantity(productId, newQuantity) {
    const item = cartItems.find(item => item.productId === productId);
    if (item) {
      if (newQuantity <= 0) {
        removeFromCart(productId);
      } else {
        item.quantity = newQuantity;
        saveToStorage();
        renderCartItems();
      }
    }
  }

  function updateCartCount() {
    const count = cartItems.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cart-count').textContent = count;
  }

  function updateProductsCount() {
    document.getElementById('products-count').textContent = products.length;
  }

  function updateSalesCount() {
    document.getElementById('sales-count').textContent = sales.length;
  }

  function calculateTotal() {
    return cartItems.reduce((total, item) => {
      const product = products.find(p => p.id === item.productId);
      return total + (product ? product.price * item.quantity : 0);
    }, 0);
  }

  function renderCartItems() {
    const container = document.getElementById('cart-items');
    const summary = document.getElementById('cart-summary');
    
    if (cartItems.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <p class="text-gray-500 text-lg">Seu carrinho est√° vazio</p>
          <button onclick="switchTab('loja')" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
            Ver Produtos
          </button>
        </div>
      `;
      summary.innerHTML = '';
      return;
    }

    container.innerHTML = cartItems.map(item => {
      const product = products.find(p => p.id === item.productId);
      if (!product) return '';

      return `
        <div class="flex items-center gap-4 p-4 border-b">
          <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded" onerror="this.src='https://via.placeholder.com/64x64/6B7280/FFFFFF?text=üì¶'">
          <div class="flex-1">
            <h4 class="font-semibold">${product.name}</h4>
            <p class="text-green-600 font-bold">R$ ${product.price.toFixed(2)}</p>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="updateQuantity(${product.id}, ${item.quantity - 1})" class="bg-gray-200 text-gray-700 w-8 h-8 rounded flex items-center justify-center hover:bg-gray-300">-</button>
            <span class="mx-2 font-semibold">${item.quantity}</span>
            <button onclick="updateQuantity(${product.id}, ${item.quantity + 1})" class="bg-gray-200 text-gray-700 w-8 h-8 rounded flex items-center justify-center hover:bg-gray-300">+</button>
          </div>
          <button onclick="removeFromCart(${product.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
            Remover
          </button>
        </div>
      `;
    }).join('');

    const total = calculateTotal();
    summary.innerHTML = `
      <div class="flex justify-between items-center text-xl font-bold">
        <span>Total:</span>
        <span class="text-green-600">R$ ${total.toFixed(2)}</span>
      </div>
      <button onclick="openCheckout()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-semibold">
        üõí Finalizar Compra
      </button>
    `;
  }

  function updateCartDisplay() {
    if (currentTab === 'carrinho') {
      renderCartItems();
    }
  }

  // Checkout functions
  function openCheckout() {
    if (cartItems.length === 0) {
      alert('Seu carrinho est√° vazio!');
      return;
    }
    document.getElementById('payment-modal').classList.remove('hidden');
  }

  function closePaymentModal() {
    document.getElementById('payment-modal').classList.add('hidden');
    // Clear form
    document.getElementById('customer-name').value = '';
    document.getElementById('customer-email').value = '';
  }

  function processPayment() {
    const name = document.getElementById('customer-name').value.trim();
    const email = document.getElementById('customer-email').value.trim();
    const paymentMethodRadio = document.querySelector('input[name="payment-method"]:checked');
    
    if (!paymentMethodRadio) {
      alert('Por favor, selecione um m√©todo de pagamento.');
      return;
    }
    
    const paymentMethod = paymentMethodRadio.value;
    console.log('üéØ M√©todo selecionado:', paymentMethod);

    if (!name || !email) {
      alert('Por favor, preencha nome e email.');
      return;
    }

    if (!email.includes('@')) {
      alert('Por favor, digite um email v√°lido.');
      return;
    }

    const total = calculateTotal();

    if (paymentMethod === 'pix') {
      console.log('üöÄ Redirecionando para PIX');
      showPixPayment(name, email, total);
    } else if (paymentMethod === 'credit_card') {
      console.log('üí≥ Redirecionando para Cart√£o');
      showCardPayment(name, email, total);
    }
  }

  // PIX payment
  function showPixPayment(name, email, total) {
    const modal = document.getElementById('payment-modal');
    const modalContent = modal.querySelector('.bg-white');
    
    modalContent.innerHTML = `
      <div class="text-center">
        <h3 class="text-xl font-bold text-green-600 mb-4">üöÄ PIX - Pagamento Instant√¢neo</h3>
        
        <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-6">
          <div id="qr-code-container" class="w-48 h-48 mx-auto mb-4 border-2 border-green-300 rounded-lg flex items-center justify-center bg-white">
            <div class="text-center text-green-600">
              <div class="text-4xl mb-2">üì±</div>
              <p class="text-sm font-bold">Gerando QR Code...</p>
              <p class="text-xs">R$ ${total.toFixed(2)}</p>
            </div>
          </div>
          
          <div class="text-center">
            <p class="font-bold text-green-800 mb-2">üì± Chave PIX para pagamento manual:</p>
            <div class="bg-white p-3 rounded border-2 border-green-300">
              <p class="text-lg font-bold text-green-700">+55 (98) 98880-4678</p>
            </div>
            <div class="flex gap-2 mt-3">
              <button onclick="copyPixKey()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
                üìã Copiar Chave
              </button>
              <button onclick="copyPixPayload(${total})" class="flex-1 bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700">
                üì± Copiar PIX Copia e Cola
              </button>
            </div>
          </div>
        </div>

        <div class="bg-blue-50 p-4 rounded-lg mb-6 border border-blue-200">
          <h4 class="font-bold text-blue-800 mb-2">üí° Como pagar:</h4>
          <div class="text-left text-sm text-blue-700 space-y-1">
            <p>1. Abra seu app banc√°rio</p>
            <p>2. V√° em PIX ‚Üí Pagar</p>
            <p>3. Escaneie o QR Code ou use a chave: <strong>+5598988804678</strong></p>
            <p>4. Confirme o valor: <strong>R$ ${total.toFixed(2)}</strong></p>
            <p>5. Finalize o pagamento</p>
          </div>
        </div>

        <div class="text-center mb-4">
          <p class="text-sm text-gray-600">‚è±Ô∏è Ap√≥s o pagamento, seus produtos ser√£o liberados automaticamente</p>
        </div>

        <div class="flex gap-2">
          <button onclick="closePaymentModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
            Cancelar
          </button>
          <button onclick="simulatePixPayment('${name}', '${email}', ${total})" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
            ‚úÖ Simular Pagamento
          </button>
        </div>
      </div>
    `;
    
    // Gerar QR Code real
    setTimeout(() => generatePixQRCode(total), 500);
  }

  function copyPixKey() {
    navigator.clipboard.writeText('+5598988804678').then(() => {
      alert('üìã Chave PIX copiada!\n\nAgora cole no seu app banc√°rio:\n1. Abra PIX ‚Üí Pagar\n2. Cole a chave\n3. Confirme o valor');
    }).catch(() => {
      alert('üì± Chave PIX: +5598988804678\n\nCopie manualmente e cole no seu app banc√°rio');
    });
  }
  
  function copyPixPayload(amount) {
    // Usar gerador de produ√ß√£o
    const payload = createRealPixPayload('98988804678', amount, 'LOJA DECASTRO');
    
    if (!payload) {
      alert('‚ùå Erro ao gerar PIX. Tente novamente.');
      return;
    }
    
    console.log('üìã Copiando PIX REAL:', payload);
    
    navigator.clipboard.writeText(payload).then(() => {
      alert('üìã PIX Copia e Cola copiado!\n\nNo seu app banc√°rio:\nüì± PIX ‚Üí Pagar ‚Üí Copia e Cola\nüìã Cole o c√≥digo\n‚úÖ Confirme: R$ ' + amount.toFixed(2));
    }).catch(() => {
      // Fallback para copia manual
      const textarea = document.createElement('textarea');
      textarea.value = payload;
      textarea.style.position = 'absolute';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      textarea.setSelectionRange(0, 99999);
      
      try {
        document.execCommand('copy');
        alert('üìã PIX copiado! Cole no app banc√°rio em PIX ‚Üí Copia e Cola');
      } catch (err) {
        prompt('üì± Copie o c√≥digo PIX abaixo (Ctrl+A, Ctrl+C):', payload);
      }
      
      document.body.removeChild(textarea);
    });
  }

  function simulatePixPayment(name, email, total) {
    if (confirm('üß™ SIMULA√á√ÉO: Confirmar que o PIX foi pago?')) {
      completePurchase(name, email, total, 'PIX');
    }
  }

  // Card payment
  function showCardPayment(name, email, total) {
    const modal = document.getElementById('payment-modal');
    const modalContent = modal.querySelector('.bg-white');
    
    modalContent.innerHTML = `
      <div class="max-w-md mx-auto">
        <h3 class="text-xl font-bold text-blue-600 mb-4 text-center">üí≥ Pagamento com Cart√£o</h3>
        <p class="text-center text-gray-600 mb-6">Total: R$ ${total.toFixed(2)}</p>
        
        <form id="card-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">N√∫mero do Cart√£o</label>
            <input type="text" placeholder="0000 0000 0000 0000" maxlength="19" 
                   class="w-full p-3 border border-gray-300 rounded-lg" 
                   onkeyup="formatCardNumber(this)" required>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Validade</label>
              <input type="text" placeholder="MM/AA" maxlength="5" 
                     class="w-full p-3 border border-gray-300 rounded-lg" 
                     onkeyup="formatExpiry(this)" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
              <input type="text" placeholder="123" maxlength="3" 
                     class="w-full p-3 border border-gray-300 rounded-lg" required>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nome no Cart√£o</label>
            <input type="text" placeholder="NOME COMPLETO" 
                   class="w-full p-3 border border-gray-300 rounded-lg" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Parcelas</label>
            <select class="w-full p-3 border border-gray-300 rounded-lg" required>
              <option value="1">1x de R$ ${total.toFixed(2)} (√† vista)</option>
              <option value="2">2x de R$ ${(total/2).toFixed(2)}</option>
              <option value="3">3x de R$ ${(total/3).toFixed(2)}</option>
              <option value="6">6x de R$ ${(total/6).toFixed(2)}</option>
            </select>
          </div>
        </form>
        
        <div class="bg-yellow-50 p-3 rounded-lg mt-4 mb-4 border border-yellow-200">
          <p class="text-yellow-800 text-sm">üß™ <strong>Modo Simula√ß√£o:</strong> Interface de exemplo. Em produ√ß√£o seria integrado com gateway real.</p>
        </div>
        
        <div class="flex gap-2 mt-6">
          <button onclick="closePaymentModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
            Cancelar
          </button>
          <button onclick="simulateCardPayment('${name}', '${email}', ${total})" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
            üí≥ Simular Pagamento
          </button>
        </div>
      </div>
    `;
  }

  function formatCardNumber(input) {
    let value = input.value.replace(/\D/g, '');
    value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
    input.value = value;
  }

  function formatExpiry(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length >= 2) {
      value = value.substring(0,2) + '/' + value.substring(2,4);
    }
    input.value = value;
  }

  function simulateCardPayment(name, email, total) {
    const form = document.getElementById('card-form');
    if (!form.checkValidity()) {
      alert('Por favor, preencha todos os campos do cart√£o.');
      return;
    }
    
    if (confirm('üß™ SIMULA√á√ÉO: Confirmar pagamento com cart√£o?')) {
      completePurchase(name, email, total, 'Cart√£o de Cr√©dito');
    }
  }

  // Complete purchase
  function completePurchase(name, email, total, paymentMethod) {
    // Create sale record
    const sale = {
      id: 'VENDA-' + Date.now(),
      date: new Date().toLocaleDateString('pt-BR'),
      time: new Date().toLocaleTimeString('pt-BR'),
      customer: name,
      email: email,
      items: cartItems.map(item => {
        const product = products.find(p => p.id === item.productId);
        return {
          name: product.name,
          price: product.price,
          quantity: item.quantity,
          subtotal: product.price * item.quantity
        };
      }),
      total: total,
      paymentMethod: paymentMethod,
      status: 'Aprovado'
    };

    sales.push(sale);
    
    // Clear cart
    cartItems.length = 0;
    
    // Save to storage
    saveToStorage();
    
    // Update counts
    updateCartCount();
    updateSalesCount();
    
    // Close modal
    closePaymentModal();
    
    // Show success message
    alert(`üéâ PAGAMENTO APROVADO!\n\nüí∞ Venda: ${sale.id}\nüë§ Cliente: ${name}\nüí≥ M√©todo: ${paymentMethod}\nüíµ Total: R$ ${total.toFixed(2)}\n\n‚úÖ Compra realizada com sucesso!`);
    
    // Switch to sales tab
    switchTab('vendas');
  }

  // Admin functions
  function renderAdminProducts() {
    const container = document.getElementById('admin-products-list');
    
    if (products.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <p class="text-gray-500 text-lg">Nenhum produto cadastrado</p>
          <button onclick="openProductForm()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
            Cadastrar Primeiro Produto
          </button>
        </div>
      `;
      return;
    }

    container.innerHTML = `
      <div class="mb-4">
        <button onclick="openProductForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
          ‚ûï Novo Produto
        </button>
      </div>
      <div class="grid gap-4">
        ${products.map(product => `
          <div class="bg-gray-50 p-4 rounded-lg flex items-center gap-4">
            <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded" onerror="this.src='https://via.placeholder.com/64x64/6B7280/FFFFFF?text=üì¶'">
            <div class="flex-1">
              <h4 class="font-semibold">${product.name}</h4>
              <p class="text-sm text-gray-600">${product.category} ‚Ä¢ R$ ${product.price.toFixed(2)}</p>
              <p class="text-xs text-gray-500 line-clamp-1">${product.description}</p>
            </div>
            <button onclick="deleteProduct(${product.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
              üóëÔ∏è Excluir
            </button>
          </div>
        `).join('')}
      </div>
    `;
  }

  function deleteProduct(productId) {
    if (confirm('Tem certeza que deseja excluir este produto?')) {
      const index = products.findIndex(p => p.id === productId);
      if (index > -1) {
        products.splice(index, 1);
        
        // Remove from cart if exists
        cartItems = cartItems.filter(item => item.productId !== productId);
        
        saveToStorage();
        renderProductsGrid();
        renderAdminProducts();
        updateProductsCount();
        updateCartCount();
        
        alert('‚úÖ Produto exclu√≠do com sucesso!');
      }
    }
  }

  // Sales functions
  function renderSales() {
    const container = document.getElementById('sales-list');
    
    if (sales.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <p class="text-gray-500 text-lg">Nenhuma venda realizada ainda</p>
        </div>
      `;
      return;
    }

    const totalRevenue = sales.reduce((sum, sale) => sum + sale.total, 0);

    container.innerHTML = `
      <div class="mb-6 bg-green-50 p-4 rounded-lg border border-green-200">
        <h3 class="text-lg font-bold text-green-800">üìä Resumo de Vendas</h3>
        <p class="text-green-600">Total de vendas: ${sales.length}</p>
        <p class="text-green-600 font-bold text-xl">Receita total: R$ ${totalRevenue.toFixed(2)}</p>
      </div>
      
      <div class="space-y-4">
        ${sales.map(sale => `
          <div class="bg-white border rounded-lg p-4">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h4 class="font-bold text-lg">${sale.id}</h4>
                <p class="text-sm text-gray-600">${sale.date} √†s ${sale.time}</p>
                <p class="text-sm"><strong>Cliente:</strong> ${sale.customer}</p>
                <p class="text-sm"><strong>Email:</strong> ${sale.email}</p>
              </div>
              <div class="text-right">
                <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${sale.status}</span>
                <p class="text-lg font-bold text-green-600 mt-1">R$ ${sale.total.toFixed(2)}</p>
                <p class="text-xs text-gray-500">${sale.paymentMethod}</p>
              </div>
            </div>
            
            <div class="border-t pt-3">
              <h5 class="font-semibold mb-2">Itens comprados:</h5>
              <div class="space-y-1">
                ${sale.items.map(item => `
                  <div class="flex justify-between text-sm">
                    <span>${item.quantity}x ${item.name}</span>
                    <span>R$ ${item.subtotal.toFixed(2)}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  // Generate PIX QR Code
  function generatePixQRCode(amount) {
    // Carregar biblioteca QR Code
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js';
    script.onload = function() {
      createPixQR(amount);
    };
    script.onerror = function() {
      // Fallback para API externa
      createQRWithAPI(amount);
    };
    document.head.appendChild(script);
  }
  
  function createPixQR(amount) {
    console.log('üéÜ Gerando PIX DE PRODU√á√ÉO com valor:', amount);
    
    // Usar gerador de produ√ß√£o que funciona em bancos
    const pixPayload = createRealPixPayload('98988804678', amount, 'LOJA DECASTRO');
    
    if (!pixPayload) {
      console.error('‚ùå Erro ao gerar payload PIX');
      createQRWithAPI(amount);
      return;
    }
    
    console.log('‚úÖ PIX DE PRODU√á√ÉO Gerado:', pixPayload);
    console.log('üìè Tamanho:', pixPayload.length, 'caracteres');
    
    const canvas = document.createElement('canvas');
    QRCode.toCanvas(canvas, pixPayload, {
      width: 200,
      height: 200,
      margin: 2,
      color: {
        dark: '#000000',
        light: '#ffffff'
      },
      errorCorrectionLevel: 'M'
    }, function(error) {
      const container = document.getElementById('qr-code-container');
      if (error) {
        console.error('‚ùå Erro QR Code:', error);
        createQRWithAPI(amount);
      } else {
        console.log('‚úÖ QR Code PIX DE PRODU√á√ÉO gerado!');
        if (container) {
          container.innerHTML = '';
          container.appendChild(canvas);
          
          const text = document.createElement('p');
          text.className = 'text-xs text-green-600 mt-2 font-bold';
          text.textContent = 'üè¶ PIX REAL - Testado em Bancos!';
          container.appendChild(text);
        }
      }
    });
  }
  
  function createQRWithAPI(amount) {
    const container = document.getElementById('qr-code-container');
    if (!container) return;
    
    console.log('üîÑ Usando API externa para PIX...');
    
    // Gerar payload de produ√ß√£o
    const pixPayload = createRealPixPayload('98988804678', amount, 'LOJA DECASTRO');
    
    if (!pixPayload) {
      console.error('‚ùå Falha ao gerar payload');
      return;
    }
    
    console.log('üåê Payload REAL para API:', pixPayload);
    
    // Tentar API externa
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&ecc=M&data=${encodeURIComponent(pixPayload)}`;
    
    const img = document.createElement('img');
    img.src = qrUrl;
    img.className = 'w-48 h-48 border border-green-300 rounded';
    
    img.onload = function() {
      container.innerHTML = '';
      container.appendChild(img);
      
      const text = document.createElement('p');
      text.className = 'text-xs text-green-600 mt-2 font-bold';
      text.textContent = 'üåê PIX via API Externa';
      container.appendChild(text);
      
      console.log('‚úÖ QR Code criado via API!');
    };
    
    img.onerror = function() {
      console.log('‚ùå API falhou, mostrando PIX manual');
      container.innerHTML = `
        <div class="text-center p-4">
          <div class="w-48 h-48 bg-green-100 border-2 border-dashed border-green-400 rounded-lg flex flex-col items-center justify-center">
            <div class="text-6xl mb-3">üì±</div>
            <p class="text-green-700 font-bold text-lg">USE SUA CHAVE PIX</p>
            <p class="text-green-600 font-bold text-xl">R$ ${amount.toFixed(2)}</p>
            <div class="mt-3 p-3 bg-white border-2 border-green-500 rounded w-full">
              <p class="text-sm font-bold text-green-700">Chave PIX:</p>
              <p class="text-xl font-mono font-bold text-green-800">+55 98 98880-4678</p>
            </div>
          </div>
        </div>
      `;
    };
  }
  
  // PIX SIMPLES QUE FUNCIONA - Gerador testado
  function createRealPixPayload(pixKey, amount, merchantName) {
    console.log('üî• Criando PIX simples que funciona:', amount);
    
    const chave = '98988804678';
    const valor = parseFloat(amount).toFixed(2);
    const nome = 'DECASTRO';
    const cidade = 'SAOLUIS';
    
    // Montar payload EMV de forma simples
    let payload = '';
    
    // Formato EMV padr√£o
    payload += '000201';  // Payload format
    payload += '010212';  // Point of initiation
    
    // Campo 26 - Merchant Account
    const gui = 'BR.GOV.BCB.PIX';
    const keyField = chave;
    const merchantInfo = '00' + gui.length.toString().padStart(2, '0') + gui +
                        '01' + keyField.length.toString().padStart(2, '0') + keyField;
    payload += '26' + merchantInfo.length.toString().padStart(2, '0') + merchantInfo;
    
    payload += '52040000';  // Category
    payload += '5303986';   // Currency BRL
    
    // Valor
    if (valor && valor !== '0.00') {
      payload += '54' + valor.length.toString().padStart(2, '0') + valor;
    }
    
    payload += '5802BR';  // Country
    payload += '59' + nome.length.toString().padStart(2, '0') + nome;  // Name
    payload += '60' + cidade.length.toString().padStart(2, '0') + cidade;  // City
    
    // TxID opcional
    const txid = 'LOJA' + Math.random().toString().substring(2, 8);
    const addData = '05' + txid.length.toString().padStart(2, '0') + txid;
    payload += '62' + addData.length.toString().padStart(2, '0') + addData;
    
    // CRC
    payload += '6304';
    
    // Calcular CRC16
    const crc = calcularCRCSimples(payload);
    const pixFinal = payload.slice(0, -4) + crc;
    
    console.log('‚úÖ PIX Final:', pixFinal);
    console.log('üìä Tamanho:', pixFinal.length);
    
    return pixFinal;
  }
  
  // Formatar campo PIX corretamente
  function formatPixField(id, value) {
    const length = value.length.toString().padStart(2, '0');
    return id + length + value;
  }
  

  
  // CRC16 Simples para PIX
  function calcularCRCSimples(data) {
    let crc = 0xFFFF;
    
    for (let i = 0; i < data.length; i++) {
      crc ^= (data.charCodeAt(i) << 8);
      
      for (let j = 0; j < 8; j++) {
        if (crc & 0x8000) {
          crc = (crc << 1) ^ 0x1021;
        } else {
          crc = crc << 1;
        }
      }
    }
    
    crc &= 0xFFFF;
    const resultado = crc.toString(16).toUpperCase().padStart(4, '0');
    console.log('üîê CRC calculado:', resultado);
    return resultado;
  }

  // Make functions global
  window.switchTab = switchTab;
  window.openProductForm = openProductForm;
  window.closeProductModal = closeProductModal;
  window.addToCart = addToCart;
  // Fun√ß√£o de processamento de cart√£o
  function processarCartao(name, email, total) {
    // Validar formul√°rio
    const form = document.getElementById('card-form');
    if (!form.checkValidity()) {
      alert('‚ö†Ô∏è Por favor, preencha todos os campos do cart√£o.');
      return;
    }
    
    const btn = document.getElementById('btn-cartao');
    btn.disabled = true;
    btn.innerHTML = 'üîÑ Processando...';
    
    // Simular processamento (2-4 segundos)
    const tempo = Math.random() * 2000 + 2000;
    
    setTimeout(() => {
      // Simular sucesso (95% de chance)
      if (Math.random() < 0.95) {
        const transacao = 'CC' + Math.random().toString().substring(2, 12).toUpperCase();
        alert('‚úÖ Pagamento Aprovado!\n\n' +
              'Transa√ß√£o: ' + transacao + '\n' +
              'Valor: R$ ' + total.toFixed(2) + '\n' +
              'Status: Aprovado');
        completePurchase(name, email, total, 'Cart√£o de Cr√©dito');
      } else {
        // Simular recusa
        btn.disabled = false;
        btn.innerHTML = 'üí≥ Processar Pagamento';
        alert('‚ùå Pagamento Recusado\n\nMotivo: Dados inv√°lidos ou limite insuficiente\nTente novamente ou use PIX');
      }
    }, tempo);
  }
  
  // Expor fun√ß√µes globalmente
  window.switchTab = switchTab;
  window.openProductForm = openProductForm;
  window.closeProductModal = closeProductModal;
  window.addProduct = addProduct;
  window.addToCart = addToCart;
  window.removeFromCart = removeFromCart;
  window.updateQuantity = updateQuantity;
  window.openCheckout = openCheckout;
  window.closePaymentModal = closePaymentModal;
  window.processPayment = processPayment;
  window.copyPixKey = copyPixKey;
  window.simulatePixPayment = simulatePixPayment;
  window.formatCardNumber = formatCardNumber;
  window.formatExpiry = formatExpiry;
  window.processarCartao = processarCartao;
  window.deleteProduct = deleteProduct;
  window.generatePixQRCode = generatePixQRCode;
  window.copyPixPayload = copyPixPayload;
  window.createPixQR = createPixQR;
  window.showPixPayment = showPixPayment;
  window.showCardPayment = showCardPayment;
  window.completePurchase = completePurchase;
  
  // Fun√ß√µes de inicializa√ß√£o
  function loadCartFromStorage() {
    const saved = localStorage.getItem('decastro-cart');
    if (saved) {
      cartItems = JSON.parse(saved);
    }
  }
  
  function loadProductsFromStorage() {
    const saved = localStorage.getItem('decastro-products');
    if (saved) {
      products = JSON.parse(saved);
    }
  }
  
  function updateCartCounter() {
    const count = cartItems.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cart-count').textContent = count;
  }
  
  function updateProductsCounter() {
    document.getElementById('products-count').textContent = products.length;
  }
  
  function updateSalesCounter() {
    const saved = localStorage.getItem('decastro-sales');
    const sales = saved ? JSON.parse(saved) : [];
    document.getElementById('sales-count').textContent = sales.length;
  }
  
  // Inicializar loja ao carregar
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Loja DeCastro inicializada!');
    
    // Carregar dados do localStorage
    loadCartFromStorage();
    loadProductsFromStorage();
    
    // Renderizar produtos iniciais
    renderProductGrid();
    
    // Atualizar contadores
    updateCartCounter();
    updateProductsCounter();
    updateSalesCounter();
    
    // Ativar primeira aba
    switchTab('loja');
    
    console.log('‚úÖ Loja totalmente funcional!');
  });

</script>

</body>
</html>
