<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja DeCastro - Produtos Digitais</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <style>
    .modal-overlay { backdrop-filter: blur(4px); }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <h1 class="text-3xl font-bold text-gray-800">🏪 Loja DeCastro - Produtos Digitais</h1>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex space-x-8">
        <button onclick="switchTab('loja')" id="tab-loja" class="py-4 px-2 border-b-2 border-blue-600 font-medium text-blue-600">
          🏪 Loja
        </button>
        <button onclick="switchTab('carrinho')" id="tab-carrinho" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          🛒 Carrinho (<span id="cart-count">0</span>)
        </button>
        <button onclick="switchTab('admin')" id="tab-admin" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          ⚙️ Administração (<span id="products-count">0</span>)
        </button>
        <button onclick="switchTab('vendas')" id="tab-vendas" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          💰 Vendas (<span id="sales-count">0</span>)
        </button>
        <button onclick="switchTab('termos')" id="tab-termos" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          📜 Termos
        </button>
        <button onclick="switchTab('privacidade')" id="tab-privacidade" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          🔒 Privacidade
        </button>
        <button onclick="switchTab('contato')" id="tab-contato" class="py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-900 hover:border-gray-300">
          📞 Contato
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-4 py-8">

    <!-- Store Tab -->
    <div id="loja-content" class="fade-in">
      <div class="mb-6 flex justify-between items-center">
        <h2 class="text-2xl font-bold flex items-center gap-2">
          <i data-lucide="store" class="w-6 h-6"></i>
          Produtos Disponíveis
        </h2>
        <button onclick="openProductForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2">
          ➕ Cadastrar Produto
        </button>
      </div>
      <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- Products rendered here -->
      </div>
    </div>

    <!-- Cart Tab -->
    <div id="carrinho-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="shopping-cart" class="w-6 h-6"></i>
          Carrinho de Compras
        </h2>
        <div id="cart-items"></div>
        <div id="cart-summary" class="mt-6 p-4 bg-gray-50 rounded-lg"></div>
      </div>
    </div>

    <!-- Admin Tab -->
    <div id="admin-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-2xl font-bold flex items-center gap-2">
            <i data-lucide="settings" class="w-6 h-6"></i>
            Administração
          </h2>
          <div class="flex gap-3">
            <button onclick="openCredentialsModal()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2 text-sm font-medium">
              MP Credenciais
            </button>
            <button onclick="openSettingsModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 text-sm font-medium">
              ⚙️ Configurações
            </button>
            <button onclick="openCategoriesModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 text-sm font-medium">
              🏷️ Categorias
            </button>
            <button onclick="openProductForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2">
              ➕ Novo Produto
            </button>
          </div>
        </div>
        <div id="admin-products-list">
          <!-- Admin products rendered here -->
        </div>
      </div>
    </div>

    <!-- Sales Tab -->
    <div id="vendas-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="dollar-sign" class="w-6 h-6"></i>
          Histórico de Vendas
        </h2>
        <div id="sales-list">
          <!-- Sales rendered here -->
        </div>
      </div>
    </div>

    <!-- Terms Tab -->
    <div id="termos-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="file-text" class="w-6 h-6"></i>
          Termos de Uso
        </h2>
        <div class="prose max-w-none">
          <h3 class="text-lg font-semibold mb-3">📋 1. Aceitação dos Termos</h3>
          <p>Ao utilizar a <strong>Loja DeCastro</strong>, você concorda com estes termos de uso.</p>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">📱 2. Produtos Digitais</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li><strong>Entrega:</strong> Produtos liberados após confirmação do pagamento</li>
            <li><strong>Acesso:</strong> Vitalício uma vez adquirido</li>
            <li><strong>Formato:</strong> Digital (PDF, vídeo, software)</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">💰 3. Pagamentos</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li><strong>PIX:</strong> Instantâneo e sem taxas</li>
            <li><strong>Cartão:</strong> Parcelamento disponível</li>
            <li><strong>Reembolso:</strong> 7 dias para produtos não acessados</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">⚠️ 4. Uso Responsável</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li>Proibido compartilhar ou revender produtos</li>
            <li>Uso pessoal conforme licença</li>
            <li>Violações podem resultar em suspensão</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Privacy Tab -->
    <div id="privacidade-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="shield" class="w-6 h-6"></i>
          Política de Privacidade
        </h2>
        <div class="prose max-w-none">
          <h3 class="text-lg font-semibold mb-3">🔒 1. Proteção de Dados</h3>
          <p>Respeitamos sua privacidade conforme a LGPD.</p>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">📆 2. Dados Coletados</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li><strong>Cadastro:</strong> Nome, email, telefone</li>
            <li><strong>Pagamento:</strong> Dados processados por gateways seguros</li>
            <li><strong>Navegação:</strong> Cookies para melhorar experiência</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">🎯 3. Como Usamos</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li>Processamento de compras</li>
            <li>Suporte ao cliente</li>
            <li>Melhorias no serviço</li>
            <li>Cumprimento legal</li>
          </ul>
          
          <h3 class="text-lg font-semibold mb-3 mt-6">🛡️ 4. Seus Direitos</h3>
          <ul class="space-y-2 list-disc list-inside">
            <li>Acesso aos seus dados</li>
            <li>Correção de informações</li>
            <li>Exclusão (direito ao esquecimento)</li>
            <li>Portabilidade dos dados</li>
          </ul>
          
          <div class="bg-blue-50 p-4 rounded-lg mt-6">
            <p class="text-sm text-blue-700"><strong>📞 Contato:</strong> privacidade@decastro.com.br</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Tab -->
    <div id="contato-content" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <i data-lucide="phone" class="w-6 h-6"></i>
          Entre em Contato
        </h2>
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="text-lg font-semibold mb-4">Informações de Contato</h3>
            <div class="space-y-3">
              <p class="flex items-center gap-2">
                <i data-lucide="phone" class="w-4 h-4 text-green-600"></i>
                <strong>WhatsApp:</strong> (98) 98880-4678
              </p>
              <p class="flex items-center gap-2">
                <i data-lucide="mail" class="w-4 h-4 text-blue-600"></i>
                <strong>Email:</strong> contato@decastro.com.br
              </p>
              <p class="flex items-center gap-2">
                <i data-lucide="clock" class="w-4 h-4 text-orange-600"></i>
                <strong>Horário:</strong> Seg-Sex, 9h às 18h
              </p>
            </div>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-4">Envie uma Mensagem</h3>
            <form class="space-y-3">
              <input type="text" placeholder="Seu nome" class="w-full border rounded-lg px-3 py-2">
              <input type="email" placeholder="Seu email" class="w-full border rounded-lg px-3 py-2">
              <textarea placeholder="Sua mensagem" rows="4" class="w-full border rounded-lg px-3 py-2"></textarea>
              <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                📧 Enviar Mensagem
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Modals -->
  
  <!-- MP Credentials Modal -->
  <div id="credentials-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg m-4 fade-in">
      <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
        <i data-lucide="key" class="w-5 h-5"></i>
        Credenciais Mercado Pago
      </h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Access Token *</label>
          <input id="mp-access-token" type="password" class="w-full border rounded-lg px-3 py-2" placeholder="APP_USR-...">
          <p class="text-xs text-gray-500 mt-1">Token para processar pagamentos</p>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Public Key *</label>
          <input id="mp-public-key" type="text" class="w-full border rounded-lg px-3 py-2" placeholder="APP_USR-...">
          <p class="text-xs text-gray-500 mt-1">Chave pública para cartões</p>
        </div>
        <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
          <p class="text-sm text-yellow-700">
            <strong>⚠️ Importante:</strong> Credenciais salvas localmente. Use apenas credenciais de teste!
          </p>
        </div>
      </div>
      <div class="flex gap-2 mt-6">
        <button onclick="closeCredentialsModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
          Cancelar
        </button>
        <button onclick="saveCredentials()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
          🔐 Salvar Credenciais
        </button>
      </div>
    </div>
  </div>

  <!-- Product Form Modal -->
  <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg m-4 fade-in">
      <h3 class="text-xl font-bold mb-4">Cadastrar Produto</h3>
      <form id="product-form" class="space-y-4">
        <input id="product-name" type="text" placeholder="Nome do produto" class="w-full border rounded-lg px-3 py-2" required>
        <input id="product-price" type="number" step="0.01" placeholder="Preço (R$)" class="w-full border rounded-lg px-3 py-2" required>
        <select id="product-category" class="w-full border rounded-lg px-3 py-2" required>
          <option value="">Selecione uma categoria</option>
        </select>
        <textarea id="product-description" placeholder="Descrição" rows="3" class="w-full border rounded-lg px-3 py-2" required></textarea>
        
        <!-- Image Upload Section -->
        <div class="space-y-2">
          <label class="block text-sm font-medium">Imagem do Produto</label>
          <div class="flex gap-2">
            <input id="product-image-file" type="file" accept="image/*" class="flex-1 border rounded-lg px-3 py-2 text-sm" onchange="handleImageUpload()">
            <button type="button" onclick="clearImage()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 text-sm">
              Limpar
            </button>
          </div>
          <div id="image-preview" class="hidden mt-2">
            <img id="preview-img" class="w-32 h-32 object-cover rounded-lg border" alt="Preview">
          </div>
          <p class="text-xs text-gray-500">Formatos: JPG, PNG, GIF (máx. 2MB)</p>
        </div>
        
        <div class="flex gap-2 mt-6">
          <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
            Cancelar
          </button>
          <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
            Cadastrar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Categories Modal -->
  <div id="categories-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md m-4 fade-in">
      <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
        <i data-lucide="tag" class="w-5 h-5"></i>
        Gerenciar Categorias
      </h3>
      
      <!-- Add Category -->
      <div class="mb-4">
        <div class="flex gap-2">
          <input id="new-category" type="text" placeholder="Nova categoria" class="flex-1 border rounded-lg px-3 py-2">
          <button onclick="addCategory()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
            ➕ Adicionar
          </button>
        </div>
      </div>
      
      <!-- Categories List -->
      <div class="max-h-60 overflow-y-auto">
        <h4 class="font-semibold mb-2">Categorias Existentes:</h4>
        <div id="categories-list" class="space-y-2">
          <!-- Categories rendered here -->
        </div>
      </div>
      
      <div class="flex gap-2 mt-6">
        <button onclick="closeCategoriesModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
          Fechar
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg m-4 fade-in">
      <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
        <i data-lucide="settings" class="w-5 h-5"></i>
        Configurações da Loja
      </h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Nome da Loja</label>
          <input id="store-name" type="text" class="w-full border rounded-lg px-3 py-2" value="Loja DeCastro">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Chave PIX</label>
          <input id="pix-key" type="text" class="w-full border rounded-lg px-3 py-2" value="98988804678">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Email de Contato</label>
          <input id="contact-email" type="email" class="w-full border rounded-lg px-3 py-2" value="contato@decastro.com.br">
        </div>
      </div>
      <div class="flex gap-2 mt-6">
        <button onclick="closeSettingsModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
          Cancelar
        </button>
        <button onclick="saveSettings()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
          ✅ Salvar
        </button>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-2xl m-4 fade-in max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
        <i data-lucide="credit-card" class="w-5 h-5"></i>
        Finalizar Pagamento
      </h3>
      
      <!-- Customer Info -->
      <div class="mb-6">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nome Completo *</label>
            <input id="customer-name" type="text" class="w-full border rounded-lg px-3 py-2" placeholder="Digite seu nome completo" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Email *</label>
            <input id="customer-email" type="email" class="w-full border rounded-lg px-3 py-2" placeholder="seu@email.com" required>
          </div>
        </div>
      </div>

      <!-- Cart Summary -->
      <div class="bg-gray-50 p-4 rounded-lg mb-6">
        <h4 class="font-semibold mb-2">Resumo do Pedido:</h4>
        <div id="payment-cart-items" class="space-y-1 mb-3 text-sm"></div>
        <div class="border-t pt-2">
          <div class="flex justify-between font-bold text-lg">
            <span>Total:</span>
            <span id="payment-total" class="text-green-600"></span>
          </div>
        </div>
      </div>

      <!-- Payment Methods -->
      <div class="mb-6">
        <label class="block text-sm font-medium mb-3">Método de Pagamento:</label>
        <div class="space-y-3">
          <label class="flex items-center p-4 border-2 border-blue-200 bg-blue-50 rounded-lg cursor-pointer hover:bg-blue-100">
            <input type="radio" name="payment-method" value="pix" class="mr-3" checked onchange="onPaymentMethodChange()">
            <span class="text-2xl mr-3">🚀</span>
            <div>
              <div class="font-bold text-blue-800">PIX - Pagamento Instantâneo</div>
              <div class="text-sm text-blue-600">✅ Aprovação imediata • ✅ Sem taxas • ✅ Disponível 24h</div>
            </div>
          </label>
          
          <label class="flex items-center p-4 border-2 border-gray-200 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
            <input type="radio" name="payment-method" value="credit_card" class="mr-3" onchange="onPaymentMethodChange()">
            <span class="text-2xl mr-3">💳</span>
            <div>
              <div class="font-bold text-gray-800">Cartão de Crédito</div>
              <div class="text-sm text-gray-600">💳 Parcelamento disponível • 🔒 Pagamento seguro</div>
            </div>
          </label>
        </div>
      </div>

      <!-- Payment Method Container -->
      <div id="payment-method-container" class="mb-6">
        <!-- PIX or Card content will be dynamically loaded here -->
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3">
        <button onclick="closePaymentModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
          Cancelar
        </button>
        <button id="process-payment-btn" onclick="processPayment()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-semibold">
          💰 Finalizar Pagamento
        </button>
      </div>
    </div>
  </div>

<script>
  // Global variables
  let products = [
    {
      id: 1,
      name: 'JavaScript Completo',
      price: 49.99,
      category: 'Programação',
      description: 'Aprenda JavaScript do zero ao avançado com projetos práticos.',
      image: 'https://images.unsplash.com/photo-1627398242454-45a1465c2479?w=400&h=250&fit=crop'
    },
    {
      id: 2,
      name: 'Marketing Digital',
      price: 39.99,
      category: 'Negócios',
      description: 'Estratégias completas de marketing digital para alavancar seu negócio.',
      image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=250&fit=crop'
    },
    {
      id: 3,
      name: 'Design UI/UX',
      price: 59.99,
      category: 'Design',
      description: 'Domine os princípios de design de interfaces e experiência do usuário.',
      image: 'https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?w=400&h=250&fit=crop'
    }
  ];
  
  let categories = ['Programação', 'Negócios', 'Design', 'Marketing', 'Educação'];
  let cartItems = [];
  let currentTab = 'loja';
  let sales = [];
  let mp = null;
  let currentProductImage = null;
  let currentPaymentMethod = 'pix';

  // Tab navigation
  function switchTab(tab) {
    // Hide all content
    const tabs = ['loja', 'carrinho', 'admin', 'vendas', 'termos', 'privacidade', 'contato'];
    tabs.forEach(t => {
      const content = document.getElementById(t + '-content');
      const tabButton = document.getElementById('tab-' + t);
      if (content) content.classList.add('hidden');
      if (tabButton) {
        tabButton.className = 'py-4 px-2 border-b-2 border-transparent font-medium text-gray-700 hover:text-gray-
